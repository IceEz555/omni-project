# üìñ Omni Project - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö Backend ‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (Complete Guide)

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö Backend ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà Hardware ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏£‡∏±‡∏ö

---

## üèóÔ∏è 1. ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö (System Architecture)

‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö **Event-Driven & Real-time** ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

```mermaid
graph LR
    A[Arduino Pressure Mat] -- USB Serial --> B(Serial Gateway);
    B -- MQTT --> C(Broker);
    C -- Subscribe --> D(Platform Service);
    C -- Subscribe --> E(Ingest Service);
    D -- Socket.io --> F[Frontend Live Monitor];
    E -- Write --> G[(InfluxDB)];
    F -- HTTP API --> D;
    D -- Query --> H[(PostgresDB)];
```

### ‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (How it works step-by-step):

1.  **‡∏Å‡∏î‡πÅ‡∏ú‡πà‡∏ô‡∏¢‡∏≤‡∏á:** Arduino ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏Å‡∏î (0-1023) ‡∏à‡∏≤‡∏Å Sensor 256 ‡∏à‡∏∏‡∏î (16x16).
2.  **‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Serial):** Arduino ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≤‡∏¢ USB ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° `TABLE ...‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... END`.
3.  **‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Gateway):** ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° `gateway.js` ‡∏≠‡πà‡∏≤‡∏ô Serial Port, ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô JSON Array.
4.  **‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ç‡πà‡∏≤‡∏ß (MQTT):** Gateway ‡∏™‡πà‡∏á JSON ‡πÑ‡∏õ‡∏ó‡∏µ‡πà MQTT Topic `iot/matrix/stream`.
5.  **‡πÅ‡∏¢‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Fork):**
    - **‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà 1 (Live View):** `Platform Service` ‡∏£‡∏±‡∏ö MQTT ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ú‡πà‡∏≤‡∏ô Socket.io ‡πÑ‡∏õ‡∏´‡∏≤ Frontend (‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å < 50ms).
    - **‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà 2 (History):** `Ingest Service` ‡∏£‡∏±‡∏ö MQTT ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á InfluxDB ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏î‡∏π‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á.
6.  **‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•:** Frontend ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Socket.io ‡∏Å‡πá‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏î‡∏™‡∏µ Heatmap (‡πÅ‡∏î‡∏á/‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô).

---

## üìÇ 2. ‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (File Descriptions)

### üÖ∞Ô∏è Platform Service (`omni-back-end/platform-service`)

‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡πà Port `4000`.

- **`index.js`**:
  - ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á Server.
  - ‡πÄ‡∏õ‡∏¥‡∏î **Socket.io Server** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠ Frontend ‡∏°‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠.
  - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ **MQTT Broker** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏Å‡∏ü‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå.
  - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -> ‡∏™‡∏±‡πà‡∏á `io.emit('matrix-data', data)` ‡∏™‡πà‡∏á‡πÑ‡∏õ Frontend ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ.
- **`prisma/schema.prisma`**:
  - ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Database (Postgres).
  - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á `Device` (‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ Serial Number).
  - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á `DeviceProfile` (‡πÄ‡∏Å‡πá‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå).
- **`controllers/deviceController.js`**:
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô Postgres.
  - ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏ä‡πá‡∏Ñ `serial_number` ‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Hardware ID.
- **`controllers/telemetryController.js`**:
  - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ InfluxDB.
  - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (`queryApi`) ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÉ‡∏´‡πâ Frontend ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô.

### üÖ±Ô∏è Serial Gateway (`omni-back-end/serial-gateway`)

‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Æ‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ß‡∏£‡πå (‡∏£‡∏±‡∏ô‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ö Arduino).

- **`gateway.js`**:
  - ‡πÉ‡∏ä‡πâ library `serialport` ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å USB Port (`COM4`).
  - ‡∏°‡∏µ Logic ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥ (Parser): ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Arduino ‡∏≠‡∏≤‡∏à‡∏°‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ó‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `END` ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏ö 1 ‡πÄ‡∏ü‡∏£‡∏°‡∏†‡∏≤‡∏û.
  - ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Auto-Reconnect: ‡∏ñ‡πâ‡∏≤‡∏™‡∏≤‡∏¢‡∏´‡∏•‡∏∏‡∏î ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏£‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏ö‡πÉ‡∏´‡∏°‡πà.

### üÜé Ingest Service (`omni-back-end/ingest-service`)

‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Low-Latency Write).

- **`ingestLogic.js`**:
  - ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å MQTT.
  - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏°?" (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏¢‡∏∞).
  - ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏•‡∏á InfluxDB ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `writeApi` (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö Batch ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î).

---

## üîå 3. API Documentation (REST API)

Frontend ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô URL `http://localhost:4000/api/admin/...` ‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö `Authorization: Bearer <token>` ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á.

### üë§ User Management

| Method | Endpoint       | Description                        |
| :----- | :------------- | :--------------------------------- |
| `GET`  | `/get-users`   | ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ User ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î             |
| `POST` | `/create-user` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Admin/User ‡πÉ‡∏´‡∏°‡πà (admin only) |

### üõ†Ô∏è Device Management

| Method   | Endpoint             | Description                    | params                              |
| :------- | :------------------- | :----------------------------- | :---------------------------------- |
| `GET`    | `/get-devices`       | ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | -                                   |
| `POST`   | `/create-device`     | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà               | `name`, `serialNumber`, `profileId` |
| `DELETE` | `/delete-device/:id` | ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå                      | `id`                                |

### üìà Telemetry (History)

| Method | Endpoint             | Description           | params                   |
| :----- | :------------------- | :-------------------- | :----------------------- |
| `GET`  | `/get-telemetry/:id` | ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á | `id` (‡πÉ‡∏ä‡πâ Serial Number) |

### üìù Device Profile

| Method | Endpoint          | Description                                  |
| :----- | :---------------- | :------------------------------------------- |
| `GET`  | `/get-profiles`   | ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Profile (‡πÄ‡∏ä‡πà‡∏ô Mat 16x16, Sensor v1) |
| `POST` | `/create-profile` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Profile ‡πÉ‡∏´‡∏°‡πà (‡∏Å‡∏≥‡∏´‡∏ô‡∏î spec ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)       |

---

---

## üîå 4. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Port ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Network & Ports)

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ü‡∏¥‡∏Å‡∏ã‡πå Port ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏ß‡πâ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `.env` ‡∏´‡∏£‡∏∑‡∏≠ `index.js` ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Service

| Port     | Service          | Protocol             | ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á                                                                                 |
| :------- | :--------------- | :------------------- | :-------------------------------------------------------------------------------------------- |
| **4000** | Platform Service | `HTTP` & `WebSocket` | **Main API:** ‡πÉ‡∏ä‡πâ‡∏¢‡∏¥‡∏á Request ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö<br>**Live Stream:** ‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û Heatmap ‡∏ú‡πà‡∏≤‡∏ô Socket.io |
| **5173** | Frontend (Vite)  | `HTTP`               | **Web Server:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö React ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤ (Dev Mode)                               |
| **1883** | Mosquitto        | `MQTT`               | **Message Broker:** ‡∏ó‡∏≤‡∏á‡∏î‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Arduino -> Server (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)                      |
| **5432** | Postgres         | `TCP`                | **Database:** ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User, Device, Profile                                                |
| **8086** | InfluxDB         | `HTTP`               | **Time-Series DB:** ‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sensor ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á                                            |
| **COM4** | Serial Port      | `UART`               | **USB Serial:** ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Arduino (‡∏ö‡∏ô Windows)                                  |

> **Note:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏¢‡πà‡∏á‡πÉ‡∏ä‡πâ Port 4000 ‡∏´‡∏£‡∏∑‡∏≠ 1883 ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ Start ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô

---

## üöÄ 5. ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Cheat Sheet)

### ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:

1.  **Start Database:** `docker-compose up -d` (Postgres, InfluxDB, MQTT).
2.  **Start Platform Service:** `npm run dev` (Port 4000).
3.  **Start Ingest Service:** `node index.js`.
4.  **Connect Arduino:** ‡πÄ‡∏™‡∏µ‡∏¢‡∏ö‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà COM4.
5.  **Start Gateway:** `node gateway.js`.
6.  **Start Frontend:** `npm run dev` (Port 5173).

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß:

- ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö -> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π **Device Inventory** -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏™‡πà ID `MAT_001` (‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏î Arduino).
- ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π **Live Monitor** -> ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û Heatmap ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!

---

---

## üîç 5. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å: ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå (Deep Dive)

### üìÇ Backend Files (`omni-back-end/platform-service`)

#### `controllers/deviceController.js`

‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Postgres

- **`createDevice`**:
  - ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤: `name`, `serialNumber`, `profileId`
  - Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `serialNumber` ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á Error
  - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: `serialNumber` ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Hardware ‡∏à‡∏£‡∏¥‡∏á
- **`getAllDevices`**:
  - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Online/Offline (mock logic ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å last_seen ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)

#### `controllers/telemetryController.js`

‡∏ó‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á InfluxDB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sensor

- **`getDeviceTelemetry`**:
  - ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤: `deviceId` (‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ Serial Number ‡πÅ‡∏ó‡∏ô ID)
  - Logic: ‡πÉ‡∏ä‡πâ InfluxQL Query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 50-100 ‡∏à‡∏∏‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ Frontend ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
  - ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Influx ‡∏à‡∏∞‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Array ‡∏Ç‡∏≠‡∏á Object ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏ó‡∏µ‡πà Frontend ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡πÜ

#### `controllers/deviceProfileController.js`

‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ "‡∏™‡πÄ‡∏õ‡∏Ñ" ‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Template)

- **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡∏ö‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ "Matrix 16x16" ‡∏´‡∏£‡∏∑‡∏≠ "Temperature Sensor"
- **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏¢‡∏±‡∏á‡πÑ‡∏á**: Ingest Service ‡∏à‡∏∞‡πÉ‡∏ä‡πâ Profile ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô JSON Blob ‡∏´‡∏£‡∏∑‡∏≠ Int)

---

## üîê 6. Authentication Flows

‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ JWT (JSON Web Token) ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô

1.  **Login**: User ‡∏™‡πà‡∏á username/password -> Server ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ `token`
2.  **Access API**: Frontend ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö `Authorization: Bearer <token>` ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å Request Header
3.  **Middleware (`authMiddleware.js`)**: ‡∏à‡∏∞‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏ó‡∏∏‡∏Å Request ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ Token ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô Role ‡∏≠‡∏∞‡πÑ‡∏£ (Admin/User)

---

## üîÑ 7. Data Flow Scenario: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏¢‡∏≤‡∏á"

1.  **Hardware**: Arduino ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏Å‡∏î -> ‡∏™‡πà‡∏á Serial `TABLE ... 1023 ... END`
2.  **Gateway**: `gateway.js` (Laptop ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° USB) ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏à‡∏≠‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `TABLE` -> ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏ô‡πÄ‡∏à‡∏≠ `END` -> ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON `[[0,0...],[...]]` -> ‡∏™‡πà‡∏á MQTT `iot/matrix/stream`
3.  **Backend (Real-time)**: `index.js` ‡∏£‡∏±‡∏ö MQTT -> ‡∏¢‡∏¥‡∏á Socket.io `emit('matrix-data')` -> ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö `liveMonitor.jsx` ‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏™‡∏µ‡πÅ‡∏î‡∏á) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
4.  **Backend (Storage)**: `ingestLogic.js` ‡∏£‡∏±‡∏ö MQTT -> ‡∏î‡∏π‡∏ß‡πà‡∏≤ Serial `MAT_001` ‡∏Ñ‡∏∑‡∏≠‡πÉ‡∏Ñ‡∏£ -> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á InfluxDB

---

‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢: **Omni Team** üöÄ
